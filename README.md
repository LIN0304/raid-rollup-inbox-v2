# Raid ‑ Retroactive Attestation of Inbox Data (v2)

> This is a set of **L1 Inbox** contracts that allows any Rollup based on *based sequencing*
> to securely publish L2 Blobs through Pre-Confirmation mode before **EIP‑4788** goes live,
> with dual-layer protection using "unsafeHead / safeHead".

## Process Overview
1. `unsafeHead`: Candidate block, generated by the latest Pre-Confer's `publish()`.
2. `safeHead`: Safe block promoted after the next Pre-Confer's Merkle proof verification.
3. L2 Nodes only Derive/Execute the corresponding Blob after the `NewSafeHead` event occurs.

## Security Improvements

This V2 implementation includes several critical security enhancements:

- ✅ **Access Control**: Proper authorization checks on critical functions
- ✅ **Reentrancy Protection**: Full protection against reentrancy attacks
- ✅ **Slot Validation**: Ensures beacon slots follow an ascending order
- ✅ **Blob Size Limits**: Prevents DoS attacks via oversized blobs
- ✅ **Emergency Controls**: Pause mechanism for critical situations
- ✅ **Default Penalty Mechanism**: Configurable slashing for defaulting preconfers
- ✅ **Fee System**: Configurable publication fees to prevent spam
- ✅ **Custom Errors**: Gas-efficient error handling with detailed information

## Development Guide
```bash
npm install    # or pnpm i / yarn
npx hardhat test
npx hardhat node &
npx hardhat run scripts/deploy.ts --network localhost
```

## Publishing Blobs
```bash
# Set environment variables
export INBOX_ADDRESS=0xYourDeployedInboxAddress
export REGISTRY_ADDRESS=0xYourDeployedRegistryAddress
export BLOB_PATH=./data/my-blob.json
export SLOT=123456
export REPLACE_UNSAFE_HEAD=true

# Run the publish script
npx hardhat run scripts/publishBlob.ts --network localhost
```

## Security Considerations

For production deployments, it's recommended to:

1. Have the contracts professionally audited
2. Replace the simplified Merkle proof verification with a complete SSZ implementation
3. Configure appropriate thresholds, collateral amounts, and fee structures
4. Perform extensive testnet testing before mainnet deployment

---

### License
MIT
